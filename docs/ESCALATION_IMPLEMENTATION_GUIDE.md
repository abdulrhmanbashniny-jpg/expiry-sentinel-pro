# ุฏููู ุชูููุฐ ูุธุงู ุงูุชุตุนูุฏ ุงูุชููุงุฆู

## ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุงูุชุตุนูุฏ ุงูุชููุงุฆู ูู ููุตุฉ Expiry Sentinel Pro ูุถูู ุนุฏู ุถูุงุน ุฃู ูุนุงููุฉ ุจุฏูู ูุชุงุจุนุฉุ ูู ุฎูุงู ุงูุชุตุนูุฏ ุงูุชุณูุณูู ุนุจุฑ ุงููุฑู ุงูุฅุฏุงุฑู.

---

## ูุณุงุฑ ุงูุชุตุนูุฏ (Sequential Escalation)

ูุชู ุงูุชุตุนูุฏ ุจุดูู ุขูู ูู ุญุงู ุนุฏู ุงุชุฎุงุฐ ุฅุฌุฑุงุก ุฎูุงู ุงูููุช ุงููุญุฏุฏ (ุงูุชุฑุงุถูุงู 24 ุณุงุนุฉ):

1. **ุงูููุธู**: ุงูุชูุจูู ุงูุฃูู ุนูุฏ ุงูุชุฑุงุจ ุชุงุฑูุฎ ุงูุงุณุชุญูุงู
2. **ุงููุดุฑู**: ุฅุฐุง ูู ูุณุชุฌุจ ุงูููุธู ุฎูุงู 24 ุณุงุนุฉ
3. **ุงููุฏูุฑ**: ุฅุฐุง ูู ูุณุชุฌุจ ุงููุดุฑู ุฎูุงู 24 ุณุงุนุฉ
4. **ุงููุฏูุฑ ุงูุนุงู**: ุฅุฐุง ูู ูุณุชุฌุจ ุงููุฏูุฑ ุฎูุงู 24 ุณุงุนุฉ
5. **ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ (HR)**: ุงูุชุตุนูุฏ ุงูููุงุฆู

---

## ุงูููููุงุช ุงูุชูููุฉ

### 1. Edge Function: `process-escalations`
- **ุงููููุน:** `supabase/functions/process-escalations/index.ts`
- **ุงูุชุดุบูู:** ูู ุณุงุนุฉ ุนุจุฑ cron ุฃู ุนูุฏ ุงูุทูุจ
- **ุงูููุงู:**
  - ุฌูุจ ุงูุชุตุนูุฏุงุช ุงููุนููุฉ ุงูุชู ุชุฌุงูุฒุช `next_escalation_at`
  - ุฌูุจ ุชูุงุตูู ุงููุนุงููุฉ (ุงูุนููุงูุ ุงููุฑุฌุนุ ุงููุณูุ ุงููุฆุฉุ ุชุงุฑูุฎ ุงูุงุณุชุญูุงู)
  - ุฌูุจ ุงุณู ุงูููุธู ุงูุฃุตูู
  - ุจูุงุก ููุฎุต ุณูุณูุฉ ุงูุงุณุชุฌุงุจุฉ (ูู ูู ูุณุชุฌุจ)
  - ุชุญุฏูุฏ ุงููุณุชูู ุงูุชุงูู ุญุณุจ ููุงุนุฏ ุงูุชุตุนูุฏ
  - ุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช ุนุจุฑ ุงููููุงุช ุงููุญุฏุฏุฉ
  - ุฅูุดุงุก ุฅุดุนุงุฑ ุฏุงุฎูู (in_app)
  - ุชุญุฏูุซ ุณุฌู ุงูุชุตุนูุฏ

### 2. ูุงุนุฏุฉ ุงูุจูุงูุงุช
- **`escalation_log`**: ุณุฌู ูุงูู ููู ุนูููุฉ ุชุตุนูุฏ
- **`escalation_rules`**: ููุงุนุฏ ูุงุจูุฉ ููุชุฎุตูุต (ุงููุณุชููุ ุงููุฏุฉุ ุงูุฏูุฑุ ุงููููุงุช)
- **`notification_log`**: ุฑุจุท ูุน ุณุฌู ุงูุฅุดุนุงุฑุงุช
- **`items`**: ุงููุนุงููุงุช ุงููุฑุชุจุทุฉ

### 3. ูุงุฌูุฉ ุงููุณุชุฎุฏู
- **`/escalation-dashboard`**: ููุญุฉ ุชุญูู ุงูุชุตุนูุฏุงุช ุงููุดุทุฉ
- **`/reminder-dashboard`**: ููุญุฉ ุงูุชุฐููุฑุงุช ูุน ุญุงูุฉ ุงูุชุตุนูุฏ
- **ุฅุดุนุงุฑุงุช ุฏุงุฎููุฉ**: ุฌุฑุณ ุงูุฅุดุนุงุฑุงุช ูู ุงูุดุฑูุท ุงูุนููู

---

## ุชูุงุตูู ุฑุณุงูุฉ ุงูุชุตุนูุฏ

ูู ุฑุณุงูุฉ ุชุตุนูุฏ ุชุชุถูู:

```
๐จ ุชุตุนูุฏ ([ุงูุฏูุฑ]) - ุงููุณุชูู [N]

[ุฑุณุงูุฉ ูุงุนุฏุฉ ุงูุชุตุนูุฏ]

๐ ุชูุงุตูู ุงููุนุงููุฉ:
๐ ุงูุนููุงู: [ุนููุงู ุงููุนุงููุฉ]
๐ข ุงููุฑุฌุน: [ุงูุฑูู ุงููุฑุฌุนู]
๐ข ุงููุณู: [ุงุณู ุงููุณู]
๐ ุงููุฆุฉ: [ุงุณู ุงููุฆุฉ]
๐ ุชุงุฑูุฎ ุงูุงุณุชุญูุงู: [ุงูุชุงุฑูุฎ]
๐ค ุงูููุธู ุงูุฃุตูู: [ุงุณู ุงูููุธู]

โ ูู ูุณุชุฌุจ: [ุงูููุธู] โ [ุงููุดุฑู] โ ...

๐ ุฑุงุจุท ุงููุนุงููุฉ:
[ุฑุงุจุท ูุจุงุดุฑ]
```

---

## ุขููุฉ ุชุญุฏูุฏ ุงููุณุชูู ุงูุชุงูู

```
ุงููุณุชูู 1 โ ูุจุญุซ ุนู ุงููุดุฑู ูู ุฌุฏูู team_memberships
ุงููุณุชูู 2 โ ูุจุญุซ ุนู ูุฏูุฑ ุงููุณู ูู ุฌุฏูู departments
ุงููุณุชูู 3 โ ูุจุญุซ ุนู ุงููุฏูุฑ ุงูุนุงู (director role)
ุงููุณุชูู 4 โ ูุจุญุซ ุนู ูุณุคูู HR (hr_admin role)
```

---

## ุณูุงุณุงุช RLS

```sql
-- ุงููุณุคูู ูุฑู ุฌููุน ุงูุชุตุนูุฏุงุช ูู ุดุฑูุชู
CREATE POLICY "Escalation: Admin access"
ON escalation_log FOR ALL
USING (is_admin_or_higher(auth.uid()));

-- ุนุฒู ุงูุดุฑูุฉ
CREATE POLICY "Escalation: Tenant isolation"
ON escalation_log FOR SELECT
USING (tenant_id = get_current_tenant_id() OR is_system_admin(auth.uid()));
```

---

## ุฎุทูุงุช ุงูุฅุนุฏุงุฏ

1. ุชุฃูุฏ ูู ูุฌูุฏ ุฌุฏููู `escalation_log` ู `escalation_rules`
2. ุฃุถู ููุงุนุฏ ุงูุชุตุนูุฏ ููู ูุณุชูู ูู `escalation_rules`
3. ุชุฃูุฏ ูู ุฅุนุฏุงุฏ `team_memberships` ูุฑุจุท ุงูููุธููู ุจุงููุดุฑููู
4. ุชุฃูุฏ ูู ุชุนููู `manager_user_id` ูู ุฌุฏูู `departments`
5. Edge Function `process-escalations` ูุชู ูุดุฑูุง ุชููุงุฆูุงู

---

**ุขุฎุฑ ุชุญุฏูุซ:** ูุจุฑุงูุฑ 15, 2026  
**ุงูุญุงูุฉ:** ููุชูู โ

# ๐จ ูุธุงู ุงูุชุตุนูุฏ ุงูุชุณูุณูู (Escalation System)

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ูุชูุฏู ูุชุตุนูุฏ ุงูุชูุจููุงุช ุบูุฑ ุงููุณุชุฌุงุจ ููุง ุชููุงุฆูุงู ุนุจุฑ ุณูุณูุฉ ูุฑููุฉ ูุญุฏุฏุฉ:
**ููุธู โ ูุดุฑู โ ูุฏูุฑ โ ูุฏูุฑ ุนุงู โ ุฅุฏุงุฑุฉ ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ**

---

## โฑ๏ธ ุขููุฉ ุงูุนูู

### ุงููุฑุญูุฉ ุงูุฃููู: ุงูุชูุจูู ุงูุฃููู (Level 0)
```
โฐ ุฅุฑุณุงู ุชูุจูู ููููุธู
   โ
   [24 ุณุงุนุฉ]
   โ
ูู ุงูููุธู ุงุณุชุฌุงุจุ
   โโ ูุนู โ โ ุงูุชูุช ุงูุนูููุฉ
   โโ ูุง โ  โ ุงูุชุตุนูุฏ ูููุดุฑู
```

### ุงููุฑุญูุฉ ุงูุซุงููุฉ: ุงูุชุตุนูุฏ ูููุดุฑู (Level 1)
```
๐ค ุฅุฑุณุงู ุฑุณุงูุฉ ูููุดุฑู
   ๐จ ุชุตุนูุฏ (ุงููุดุฑู) - ุงููุณุชูู 1
   ๐ ุชูุงุตูู ุงููุนุงููุฉ ุงููุงููุฉ
   โ ูู ูุณุชุฌุจ: ุงูููุธู
   ๐ ุฑุงุจุท ูุจุงุดุฑ ูููุนุงููุฉ
   โ
   [24 ุณุงุนุฉ]
   โ
ูู ุงููุดุฑู ุงุณุชุฌุงุจุ
   โโ ูุนู โ โ ุงูุชูุช ุงูุนูููุฉ
   โโ ูุง โ  โ ุงูุชุตุนูุฏ ูููุฏูุฑ
```

### ุงููุฑุญูุฉ ุงูุซุงูุซุฉ: ุงูุชุตุนูุฏ ูููุฏูุฑ (Level 2)
```
๐ค ุฅุฑุณุงู ุฑุณุงูุฉ ูููุฏูุฑ
   ๐จ ุชุตุนูุฏ (ุงููุฏูุฑ) - ุงููุณุชูู 2
   ๐ ุชูุงุตูู ุงููุนุงููุฉ ุงููุงููุฉ
   โ ูู ูุณุชุฌุจ: ุงูููุธู โ ุงููุดุฑู
   ๐ ุฑุงุจุท ูุจุงุดุฑ ูููุนุงููุฉ
   โ
   [24 ุณุงุนุฉ]
   โ
ูู ุงููุฏูุฑ ุงุณุชุฌุงุจุ
   โโ ูุนู โ โ ุงูุชูุช ุงูุนูููุฉ
   โโ ูุง โ  โ ุงูุชุตุนูุฏ ูููุฏูุฑ ุงูุนุงู
```

### ุงููุฑุญูุฉ ุงูุฑุงุจุนุฉ: ุงูุชุตุนูุฏ ูููุฏูุฑ ุงูุนุงู (Level 3)
```
๐ค ุฅุฑุณุงู ุฑุณุงูุฉ ูููุฏูุฑ ุงูุนุงู
   ๐จ ุชุตุนูุฏ (ุงููุฏูุฑ ุงูุนุงู) - ุงููุณุชูู 3
   โ ูู ูุณุชุฌุจ: ุงูููุธู โ ุงููุดุฑู โ ุงููุฏูุฑ
   โ
   [24 ุณุงุนุฉ]
   โ
ูู ุงููุฏูุฑ ุงูุนุงู ุงุณุชุฌุงุจุ
   โโ ูุนู โ โ ุงูุชูุช ุงูุนูููุฉ
   โโ ูุง โ  โ ุงูุชุตุนูุฏ ู HR
```

### ุงููุฑุญูุฉ ุงูุฎุงูุณุฉ: ุงูุชุตุนูุฏ ู HR (Level 4)
```
๐ค ุฅุฑุณุงู ุฑุณุงูุฉ ู ุฅุฏุงุฑุฉ ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ
   ๐จ ุชุตุนูุฏ ููุงุฆู - ุงููุณุชูู 4
   โ ูู ูุณุชุฌุจ: ุฌููุน ุงููุณุชููุงุช ุงูุณุงุจูุฉ
   + ุชูุฑูุฑ ุดุงูู ุจุงููุนุงููุฉ
   + ุณุฌู ูุงูู ููุชุตุนูุฏุงุช
```

---

## ๐ฉ ูุญุชูู ุฑุณุงูุฉ ุงูุชุตุนูุฏ

ูู ุฑุณุงูุฉ ุชุตุนูุฏ ุชุชุถูู ุงููุนูููุงุช ุงูุชุงููุฉ:

```
๐จ ุชุตุนูุฏ (ุงููุฏูุฑ) - ุงููุณุชูู 2

ูุฏูู ูุนุงููุฉ ุชุญุชุงุฌ ุชุฏุฎูู ุงูุนุงุฌู:

๐ ุชูุงุตูู ุงููุนุงููุฉ:
๐ ุงูุนููุงู: ุชุฌุฏูุฏ ุฑุฎุตุฉ ุงูููุงุฏุฉ
๐ข ุงููุฑุฌุน: REF-2026-001
๐ข ุงููุณู: ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ
๐ ุงููุฆุฉ: ุฑุฎุต
๐ ุชุงุฑูุฎ ุงูุงุณุชุญูุงู: 2026-02-20
๐ค ุงูููุธู ุงูุฃุตูู: ุฃุญูุฏ ูุญูุฏ

โ ูู ูุณุชุฌุจ: ุงูููุธู โ ุงููุดุฑู

๐ ุฑุงุจุท ุงููุนุงููุฉ:
https://expiry-sentinel-pro.lovable.app/items/xxx-xxx
```

---

## ๐๏ธ ุฌุฏุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 1. ุฌุฏูู ุณุฌูุงุช ุงูุชุตุนูุฏ (`escalation_log`)
| ุงูุนููุฏ | ุงูููุน | ุงููุตู |
|--------|-------|-------|
| `id` | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| `tenant_id` | UUID | ูุนุฑู ุงูุดุฑูุฉ |
| `item_id` | UUID | ุงููุนุงููุฉ ุงููุฑุชุจุทุฉ |
| `notification_id` | UUID | ุงูุฅุฎุทุงุฑ ุงูุฃุตูู |
| `original_recipient_id` | UUID | ุงููุณุชูุจู ุงูุฃูู (ุงูููุธู) |
| `current_recipient_id` | UUID | ุงููุชุณูู ุงูุญุงูู |
| `previous_recipient_id` | UUID | ุงููุชุณูู ุงูุณุงุจู |
| `escalation_level` | INT | ูุณุชูู ุงูุชุตุนูุฏ (0-4) |
| `escalation_reason` | TEXT | ุณุจุจ ุงูุชุตุนูุฏ |
| `status` | TEXT | ุงูุญุงูุฉ: pending, acknowledged, resolved |
| `acknowledged_at` | TIMESTAMP | ููุช ุงูุงุณุชูุงู |
| `acknowledged_by` | UUID | ูู ุงุณุชูู |
| `sent_at` | TIMESTAMP | ููุช ุงูุฅุฑุณุงู |
| `next_escalation_at` | TIMESTAMP | ููุนุฏ ุงูุชุตุนูุฏ ุงูุชุงูู |

### 2. ุฌุฏูู ููุงุนุฏ ุงูุชุตุนูุฏ (`escalation_rules`)
| ุงูุนููุฏ | ุงูููุน | ุงููุตู |
|--------|-------|-------|
| `id` | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| `tenant_id` | UUID | ูุนุฑู ุงูุดุฑูุฉ |
| `escalation_level` | INT | ูุณุชูู ุงูุชุตุนูุฏ (1-4) |
| `delay_hours` | INT | ุงูุงูุชุธุงุฑ ูุจู ุงูุชุตุนูุฏ (ุณุงุนุงุช) |
| `recipient_role` | TEXT | ุงูุฏูุฑ ุงููุณุชูุฏู |
| `notification_channels` | TEXT[] | ูููุงุช ุงูุฅุดุนุงุฑ |
| `message_template` | TEXT | ูุงูุจ ุงูุฑุณุงูุฉ |
| `is_active` | BOOLEAN | ููุนูู ุฃู ูุง |

---

## โ๏ธ Edge Function: `process-escalations`

### ุงูููุงุท ุงูุฑุฆูุณูุฉ:
1. ุชุนูู ูู ุณุงุนุฉ (ุฃู ุนูุฏ ุงูุทูุจ)
2. ุชุฌูุจ ุฌููุน ุงูุชุตุนูุฏุงุช ุงููุนููุฉ ุงูุชู ุชุฌุงูุฒุช ููุชูุง
3. ุชุฌูุจ ุชูุงุตูู ุงููุนุงููุฉ ุงููุงููุฉ (ุงูุนููุงูุ ุงููุฑุฌุนุ ุงููุณูุ ุงููุฆุฉ)
4. ุชุจูู ููุฎุต ุณูุณูุฉ ุงูุงุณุชุฌุงุจุฉ (ูู ูู ูุณุชุฌุจ)
5. ุชุฑุณู ุงูุฅุฎุทุงุฑุงุช ุนุจุฑ ุงููููุงุช ุงููุญุฏุฏุฉ ูุน ุฑุงุจุท ูุจุงุดุฑ
6. ุชูุดุฆ ุฅุดุนุงุฑ ุฏุงุฎูู (in_app) ูููุณุชูู ุงูุฌุฏูุฏ

---

## ๐ ููุญุฉ ุชุญูู ุงูุชุตุนูุฏุงุช (`/escalation-dashboard`)

### ุงูููููุงุช:
- โ ุนุฑุถ ุงูุชุตุนูุฏุงุช ุงููุดุทุฉ ูุน ูุณุชูู ูู ูููุง
- โ ุชูุงุฑูุฑ ุงูุชุตุนูุฏุงุช ุงููุชูุฑุฑุฉ ุญุณุจ ุงูููุธู
- โ ุชุชุจุน ุงูููุช ุงููุชุจูู ููุชุตุนูุฏ ุงูุชุงูู
- โ ุฅุฌุฑุงุกุงุช ูุฏููุฉ (ุงุณุชุฆูุงูุ ุฅูุบุงุก)
- โ ุฅุญุตุงุฆูุงุช ูุนุฏู ุงูุงุณุชุฌุงุจุฉ ููู ูุณุชูู

---

## ๐ ุณูุงุณุงุช ุงูุฃูุงู (RLS)

- ูู ูุณุชุฎุฏู ูุฑู ููุท ุชุตุนูุฏุงุช ุดุฑูุชู (`tenant_id`)
- ุงููุณุคูู ูุฑู ุฌููุน ุงูุชุตุนูุฏุงุช ูู ุดุฑูุชู
- ูุฏูุฑ ุงููุธุงู ูุฑู ุงููู

---

## ๐ง ุงูุฅุนุฏุงุฏุงุช ุงููุงุจูุฉ ููุชุฎุตูุต

ูููู ุชุนุฏูู ููุงุนุฏ ุงูุชุตุนูุฏ ูู ุตูุญุฉ ุงูุฅุนุฏุงุฏุงุช ุฃู ูุงุนุฏุฉ ุงูุจูุงูุงุช:

```json
{
  "level_1": { "delay_hours": 24, "recipient_role": "supervisor", "channels": ["whatsapp", "telegram", "in_app"] },
  "level_2": { "delay_hours": 24, "recipient_role": "manager", "channels": ["whatsapp", "telegram", "in_app"] },
  "level_3": { "delay_hours": 24, "recipient_role": "director", "channels": ["whatsapp", "telegram", "in_app"] },
  "level_4": { "delay_hours": 24, "recipient_role": "hr_admin", "channels": ["whatsapp", "telegram", "in_app"] }
}
```

---

## โ ุญุงูุฉ ุงูููุฒุงุช

| ุงูููุฒุฉ | ุงูุญุงูุฉ |
|--------|--------|
| ุชุตุนูุฏ ุชุณูุณูู ุชููุงุฆู | โ ููุชูู |
| ููุฎุต ุณูุณูุฉ ุงูุงุณุชุฌุงุจุฉ | โ ููุชูู |
| ุฑุณุงุฆู ุงุญุชุฑุงููุฉ ูุน ุงูุชูุงุตูู | โ ููุชูู |
| ุฑุงุจุท ูุจุงุดุฑ ูููุนุงููุฉ | โ ููุชูู |
| ุชุชุจุน ูุงูู ููุณุฌูุงุช | โ ููุชูู |
| ุฅุฎุทุงุฑุงุช ูุชุนุฏุฏุฉ ุงููููุงุช | โ ููุชูู |
| ููุญุฉ ุชุญูู ุงูุชุตุนูุฏุงุช | โ ููุชูู |
| ุชูุงุฑูุฑ ููุตูุฉ | โ ููุชูู |
| RLS ุขูู | โ ููุชูู |
| ุชุฎุตูุต ูุงูู ููููุงุนุฏ | โ ููุชูู |

---

**ุขุฎุฑ ุชุญุฏูุซ:** ูุจุฑุงูุฑ 15, 2026  
**ุงูุญุงูุฉ:** ููุชูู ูุฌุงูุฒ ููุฅูุชุงุฌ โ

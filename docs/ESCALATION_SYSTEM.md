# ๐จ ูุธุงู ุงูุชุตุนูุฏ ุงูุชุณูุณูู (Escalation System)

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ูุชูุฏู ูุชุตุนูุฏ ุงูุชูุจููุงุช ุบูุฑ ุงููุณุชุฌุงุจ ููุง ุชููุงุฆูุงู ุนุจุฑ ุณูุณูุฉ ูุฑููุฉ ูุญุฏุฏุฉ:
**ููุธู โ ูุดุฑู โ ูุฏูุฑ โ ูุฏูุฑ ุนุงู โ ุฅุฏุงุฑุฉ ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ**

---

## โฑ๏ธ ุขููุฉ ุงูุนูู

### ุงููุฑุญูุฉ ุงูุฃููู: ุงูุชูุจูู ุงูุฃููู (Level 0)
```
โฐ ุฅุฑุณุงู ุชูุจูู ููููุธู
   โ
   [24 ุณุงุนุฉ]
   โ
ูู ุงูููุธู ุงุณุชุฌุงุจุ
   โโ ูุนู โ โ ุงูุชูุช ุงูุนูููุฉ
   โโ ูุง โ  โ ุงูุชุตุนูุฏ ูููุดุฑู
```

### ุงููุฑุญูุฉ ุงูุซุงููุฉ: ุงูุชุตุนูุฏ ูููุดุฑู (Level 1)
```
๐ค ุฅุฑุณุงู ุฑุณุงูุฉ ูููุดุฑู
   "ุงูููุธู [ุงูุงุณู] ูู ูุณุชุฌุจ ูููุนุงููุฉ"
   โ
   [24 ุณุงุนุฉ]
   โ
ูู ุงููุดุฑู ุงุณุชุฌุงุจุ
   โโ ูุนู โ โ ุงูุชูุช ุงูุนูููุฉ
   โโ ูุง โ  โ ุงูุชุตุนูุฏ ูููุฏูุฑ
```

### ุงููุฑุญูุฉ ุงูุซุงูุซุฉ: ุงูุชุตุนูุฏ ูููุฏูุฑ (Level 2)
```
๐ค ุฅุฑุณุงู ุฑุณุงูุฉ ูููุฏูุฑ
   "ุงูููุธู ูุงููุดุฑู ูู ูุณุชุฌูุจุง ูููุนุงููุฉ"
   โ
   [24 ุณุงุนุฉ]
   โ
ูู ุงููุฏูุฑ ุงุณุชุฌุงุจุ
   โโ ูุนู โ โ ุงูุชูุช ุงูุนูููุฉ
   โโ ูุง โ  โ ุงูุชุตุนูุฏ ูููุฏูุฑ ุงูุนุงู
```

### ุงููุฑุญูุฉ ุงูุฑุงุจุนุฉ: ุงูุชุตุนูุฏ ูููุฏูุฑ ุงูุนุงู (Level 3)
```
๐ค ุฅุฑุณุงู ุฑุณุงูุฉ ูููุฏูุฑ ุงูุนุงู
   "ุซูุงุซ ูุณุชููุงุช ูู ุชุณุชุฌุจ - ุชุตุนูุฏ ุญุฑุฌ"
   โ
   [24 ุณุงุนุฉ]
   โ
ูู ุงููุฏูุฑ ุงูุนุงู ุงุณุชุฌุงุจุ
   โโ ูุนู โ โ ุงูุชูุช ุงูุนูููุฉ
   โโ ูุง โ  โ ุงูุชุตุนูุฏ ู HR
```

### ุงููุฑุญูุฉ ุงูุฎุงูุณุฉ: ุงูุชุตุนูุฏ ู HR (Level 4)
```
๐ค ุฅุฑุณุงู ุฑุณุงูุฉ ู ุฅุฏุงุฑุฉ ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ
   "ุชุตุนูุฏ ููุงุฆู - ุฌููุน ุงููุณุชููุงุช ูู ุชุณุชุฌุจ"
   + ุชูุฑูุฑ ุดุงูู ุจุงููุนุงููุฉ
   + ุณุฌู ูุงูู ููุชุตุนูุฏุงุช
```

---

## ๐๏ธ ุฌุฏุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 1. ุฌุฏูู ุงููุฑููุฉ ุงููุธูููุฉ
```sql
CREATE TABLE organizational_hierarchy (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  tenant_id UUID NOT NULL,
  employee_id UUID NOT NULL,
  supervisor_id UUID,          -- ุงููุดุฑู ุงููุจุงุดุฑ
  manager_id UUID,             -- ุงููุฏูุฑ
  director_id UUID,            -- ุงููุฏูุฑ ุงูุนุงู
  department_id UUID,
  created_at TIMESTAMP DEFAULT now(),
  updated_at TIMESTAMP DEFAULT now()
);
```

### 2. ุฌุฏูู ุณุฌูุงุช ุงูุชุตุนูุฏ
```sql
CREATE TABLE escalation_log (
  id UUID PRIMARY KEY,
  tenant_id UUID NOT NULL,
  reminder_id UUID NOT NULL,   -- ุงูุฅุฎุทุงุฑ ุงูุฃุตูู
  item_id UUID NOT NULL,       -- ุงููุนุงููุฉ
  original_recipient_id UUID,  -- ุงููุณุชูุจู ุงูุฃูู (ุงูููุธู)
  escalation_level INT,        -- 0-4
  current_recipient_id UUID,   -- ุงููุชุณูู ุงูุญุงูู
  status VARCHAR(50),          -- pending, acknowledged, resolved
  acknowledged_at TIMESTAMP,
  acknowledged_by UUID,
  sent_at TIMESTAMP,
  escalated_at TIMESTAMP,
  next_escalation_at TIMESTAMP
);
```

### 3. ุฌุฏูู ููุงุนุฏ ุงูุชุตุนูุฏ
```sql
CREATE TABLE escalation_rules (
  id UUID PRIMARY KEY,
  tenant_id UUID NOT NULL,
  escalation_level INT,                    -- 1-4
  delay_hours INT DEFAULT 24,              -- ุงููุชุฑุฉ ุงูุฒูููุฉ
  recipient_role VARCHAR(100),             -- ุงูุฏูุฑ
  notification_channels TEXT[] DEFAULT ['email', 'whatsapp', 'in_app'],
  is_active BOOLEAN DEFAULT true
);
```

---

## ๐ RLS Policies

```sql
-- Policy 1: ูู ูุณุชุฎุฏู ูุฑู ุงูุชุตุนูุฏุงุช ุงูุฎุงุตุฉ ุจู
CREATE POLICY escalation_log_user_access ON escalation_log
  USING (
    auth.uid() = current_recipient_id 
    OR auth.uid() = original_recipient_id
    OR EXISTS (
      SELECT 1 FROM profiles 
      WHERE id = auth.uid() 
      AND role IN ('hr_admin', 'director')
    )
  );

-- Policy 2: ุงูููุธู ูุง ูุฑู ุงูุชุตุนูุฏุงุช ุงูุฃุฎุฑู
CREATE POLICY escalation_log_tenant_isolation ON escalation_log
  USING (
    tenant_id = get_current_tenant_id()
  );
```

---

## โ๏ธ Edge Function

### ุงูููุงุท ุงูุฑุฆูุณูุฉ:
1. ุชุดุชุบู ูู ุณุงุนุฉ
2. ุชุดูู ุฌููุน ุงูุชุตุนูุฏุงุช ุงููุนููุฉ
3. ุชุชุญูู ูู ุงูููุช ุงููููุถู
4. ุชุตุนุฏ ุชููุงุฆูุงู ุฅุฐุง ุชุฌุงูุฒ 24 ุณุงุนุฉ
5. ุชุฑุณู ุงูุฅุฎุทุงุฑุงุช ุนุจุฑ ุงููููุงุช ุงููุฎุชููุฉ

---

## ๐ ููุญุฉ ุชุญูู ุงูุชุตุนูุฏุงุช

### ุงูููููุงุช:
- โ ุนุฑุถ ุงูุชุตุนูุฏุงุช ุงููุดุทุฉ
- โ ุชูุงุฑูุฑ ุงูุชุตุนูุฏุงุช ุงููุชูุฑุฑุฉ
- โ ุชุชุจุน ุงูููุช ุงููุชุจูู
- โ ุฅุฌุฑุงุกุงุช ูุฏููุฉ (ุงุณุชุฆูุงูุ ุฅูุบุงุกุ ุฅุนุงุฏุฉ)

---

## ๐ ุงูุชูุงุฑูุฑ

### 1. ุชูุฑูุฑ ุงูุชุตุนูุฏุงุช ุงููุชูุฑุฑุฉ
```
ุงูููุธููู ุงูุฐูู ูุฏููู ุชุตุนูุฏุงุช ูุชูุฑุฑุฉ
- ุงูููุธู: [ุงูุงุณู]
- ุนุฏุฏ ุงูุชุตุนูุฏุงุช: 5
- ุขุฎุฑ ุชุตุนูุฏ: 2026-02-01
```

### 2. ุชูุฑูุฑ ุงูุฃุฏุงุก ุญุณุจ ุงููุณุชูู
```
ูุนุฏู ุงูุงุณุชุฌุงุจุฉ:
- ุงููุดุฑููู: 85%
- ุงููุฏูุฑูู: 92%
- ุงููุฏูุฑูู ุงูุนุงููู: 78%
```

---

## ๐จ ุงูุชูุจููุงุช

### ูุชู ูุชู ุงูุชูุจูู:
1. **ุชุตุนูุฏ ูุชูุฑุฑ** - ููุณ ุงูููุธู 3+ ูุฑุงุช
2. **ุนุฏู ุงุณุชุฌุงุจุฉ ุงููุฏูุฑ ุงูุนุงู** - ูุคุดุฑ ูุดููุฉ ูุฑููุฉ
3. **ุชุตุนูุฏ ู HR** - ุญุงูุฉ ุญุฑุฌุฉ ุฌุฏุงู

---

## ๐ ุญุงูุงุช ุงูุงุณุชุฎุฏุงู

### ุงูุญุงูุฉ 1: ูุนุงููุฉ ุงูุชูุช ุงูุตูุงุญูุฉ
```
ููุธู: ูู ูุฑูุน ุชูุฑูุฑ
  โ 24 ุณุงุนุฉ
ูุดุฑู: ูู ูุชุงุจุน
  โ 24 ุณุงุนุฉ  
ูุฏูุฑ: ููุงูู ุนูู ุงูุชูุฏูุฏ
โ ุชูุช ุงููุนุงูุฌุฉ
```

### ุงูุญุงูุฉ 2: ูุดููุฉ ูุฑููุฉ
```
ููุธู: ูู ูุณุชุฌุจ โ 0 ุชูุงุนู
ูุดุฑู: ูู ูุณุชุฌุจ โ 0 ุชูุงุนู
ูุฏูุฑ: ูู ูุณุชุฌุจ โ 0 ุชูุงุนู
ูุฏูุฑ ุนุงู: ูุฑู ุงููุดููุฉ โ ูุชุฏุฎู
```

---

## ๐ฑ ูููุงุช ุงูุฅุฎุทุงุฑ

- ๐ง **ุงูุจุฑูุฏ ุงูุฅููุชุฑููู** - ููุตู ูุดุงูู
- ๐ฌ **WhatsApp** - ููุฑู ููุตูุฑ
- ๐ **In-App** - ุชุชุจุน ููุฑู

---

## ๐ง ุงูุฅุนุฏุงุฏุงุช ุงููุงุจูุฉ ููุชุฎุตูุต

```json
{
  "escalation_rules": {
    "level_1": {
      "delay_hours": 24,
      "recipient_role": "supervisor"
    },
    "level_2": {
      "delay_hours": 24,
      "recipient_role": "manager"
    },
    "level_3": {
      "delay_hours": 24,
      "recipient_role": "director"
    },
    "level_4": {
      "delay_hours": 24,
      "recipient_role": "hr_admin"
    }
  }
}
```

---

## โ ุงูููุฒุงุช

โ ุชุตุนูุฏ ุชุณูุณูู ุชููุงุฆู  
โ ุชุชุจุน ูุงูู ููุณุฌูุงุช  
โ ุฅุฎุทุงุฑุงุช ูุชุนุฏุฏุฉ ุงููููุงุช  
โ ุชูุงุฑูุฑ ููุตูุฉ  
โ RLS ุขูู  
โ ุชุฎุตูุต ูุงูู ููููุงุนุฏ  
โ ุงุณุชุฆูุงู ูุฏูู  
โ ุชูุจููุงุช ููุฃููุงุท ุงููุดููุฉ  

---

**ุขุฎุฑ ุชุญุฏูุซ:** 1 ูุจุฑุงูุฑ 2026  
**ุงูุญุงูุฉ:** ููุฏ ุงูุชุทููุฑ
